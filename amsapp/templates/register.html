{% extends "index.html" %}
{% block content %}
<div class="container mx-auto p-8">
    <header class="text-2xl font-bold mb-8">Registration</header>
    <form method="post" class="bg-white p-6 rounded-lg shadow-md">
        {% csrf_token %}
        <!-- First Name and Last Name -->
        <div class="mb-6">
            <span class="block text-xl font-bold mb-4">Personal Details</span>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">First Name</label>
                    <input type="text" name="first_name" placeholder="Enter your first name"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Last Name</label>
                    <input type="text" name="last_name" placeholder="Enter your last name"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Username</label>
                    <input type="text" name="username" placeholder="Enter your Username"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                    <small class="text-red-500">{{ form.errors.username }}</small>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Email</label>
                    <input type="email" name="email" placeholder="Enter your Email"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                    <small class="text-red-500">{{ form.errors.email }}</small>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Password</label>
                    <input type="password" name="password1" placeholder="Enter your Password"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                    <small class="text-red-500">{{ form.errors.password1 }}</small>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Re-type Password</label>
                    <input type="password" name="password2" placeholder="Re-type Password"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                    <small class="text-red-500">{{ form.errors.password2 }}</small>
                </div>

                <div class="mb-4">
                    <label for="mobile_number">Mobile Number</label>
                    <input type="tel" name="mobile_number" placeholder="Enter mobile number"
                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                    <small class="text-red-500">{{ p_reg_form.errors.mobile_number }}</small>
                </div>
                <div class="mb-4">

                    <label for="id_gender"
                        class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Gender</label>
                    <select name="gender"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                        required="" id="id_gender">
                        <option disabled selected>Select gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Others</option>
                    </select>
    
                    <small class="text-red-500">{{ p_reg_form.errors.gender }}</small>
                </div>

            </div>
            <!-- Username -->

           
            <div class="mb-6">
                <span class="block text-xl font-bold mb-4">Address Details</span>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Add similar structures for address details -->
                    <div class="mb-4">
                        <label for="Address">Address</label>
                        <input type="text" name="Address" placeholder="Permanent or Temporary"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500">
                        <small class="text-red-500">{{ p_reg_form.errors.Address }}</small>

                    </div>
                    <div class="mb-4">
                        <label for="{{ p_reg_form.pincode.id_for_label }}"
                            class="block text-gray-600 font-semibold ">Pincode</label>
                        <input type="text" id="{{ p_reg_form.pincode.id_for_label }}"
                            name="{{ p_reg_form.pincode.name }}"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500"
                            placeholder="Pincode">
                        <small class="text-red-500">{{ p_reg_form.errors.pincode }}</small>

                    </div>
                    <div class="mb-4">
                        <label for="{{ p_reg_form.district.id_for_label }}"
                            class="block text-gray-600 font-semibold mb-2">District</label>
                        <input type="text" id="{{ p_reg_form.district.id_for_label }}"
                            name="{{ p_reg_form.district.name }}"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500"
                            placeholder="District">
                    </div>
                    <div class="mb-4">
                        <label for="{{ p_reg_form.state.id_for_label }}"
                            class="block text-gray-600 font-semibold mb-2">State</label>
                        <input type="text" id="{{ p_reg_form.state.id_for_label }}" name="{{ p_reg_form.state.name }}"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500"
                            placeholder="State">
                    </div>
                    <div class="mb-4">
                        <label for="{{ p_reg_form.postName.id_for_label }}"
                            class="block text-gray-600 font-semibold mb-2">Post
                            Office Name</label>
                        <input type="text" id="{{ p_reg_form.postName.id_for_label }}"
                            name="{{ p_reg_form.postName.name }}"
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-blue-500"
                            placeholder="Post Office Name">
                    </div>
                </div>
            </div>


            <div id="select-container"></div>

            <button type="button" id="get-details-button"
                class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 focus:outline-none focus:shadow-outline">Get
                Details</button>
            <button type="submit"
                class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-700 focus:outline-none focus:shadow-outline">Register</button>
    </form>

</div>
</div>







<script>
    document.getElementById('get-details-button').addEventListener('click', function () {
        var pincode = document.getElementById('id_pincode').value;

        if (pincode) {
            fetch('https://api.postalpincode.in/pincode/' + pincode)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    if (data && data[0] && data[0].PostOffice) {
                        var postOffices = data[0].PostOffice;

                        if (postOffices.length > 0) {
                            // Create a select element
                            var selectElement = document.createElement('select');
                            selectElement.id = 'id_postName'; // Set the same ID as your form field

                            // Create options for each post office
                            for (var i = 0; i < postOffices.length; i++) {
                                var option = document.createElement('option');
                                option.value = postOffices[i].Name;
                                option.text = postOffices[i].Name;
                                selectElement.appendChild(option);
                            }

                            // Append the select element to the placeholder div
                            var selectContainer = document.getElementById('select-container');
                            selectContainer.innerHTML = ''; // Clear any previous content in the container
                            selectContainer.appendChild(selectElement);

                            // Listen for changes in the select element
                            selectElement.addEventListener('change', function () {
                                // Update the "postName" field when an option is selected
                                var selectedOption = selectElement.options[selectElement.selectedIndex];
                                document.getElementById('id_postName').value = selectedOption.value;
                                var district = postOffices[selectElement.selectedIndex].District;
                                var state = postOffices[selectElement.selectedIndex].State;
                                document.getElementById('id_district').value = district;
                                document.getElementById('id_state').value = state;
                            });
                        } else {
                            alert('No Post Offices found for this pincode.');
                        }
                    } else {
                        alert('Pincode not found or API request failed.');
                    }
                })
                .catch(function (error) {
                    alert('An error occurred while fetching data: ' + error);
                });
        } else {
            alert('Please enter a pincode.');
        }
    });
</script>



{% endblock %}